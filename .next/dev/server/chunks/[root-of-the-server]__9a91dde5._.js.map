{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yira/Documents/code/gemini3-yira-s-website/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\n// 服务器端使用\r\nconst supabaseUrl = process.env.SUPABASE_URL || '';\r\nconst supabaseAnonKey = process.env.SUPABASE_ANON_KEY || '';\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.warn('Missing Supabase environment variables');\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\nexport interface Booking {\r\n  id?: string;\r\n  name: string;\r\n  contact: string;\r\n  booking_date: string;\r\n  booking_time: string;\r\n  booking_type: string;\r\n  details?: string;\r\n  created_at?: string;\r\n}\r\n\r\n// 获取 PHOTO bucket 中的所有图片\r\nexport async function getPhotos() {\r\n  const { data, error } = await supabase.storage\r\n    .from('PHOTO')\r\n    .list('', {\r\n      limit: 100,\r\n      offset: 0,\r\n      sortBy: { column: 'created_at', order: 'desc' }\r\n    });\r\n\r\n  if (error) {\r\n    console.error('Error fetching photos:', error);\r\n    return [];\r\n  }\r\n\r\n  // 过滤出图片文件并生成公开 URL\r\n  const photos = data\r\n    .filter(file => {\r\n      const ext = file.name.toLowerCase();\r\n      return ext.endsWith('.jpg') || ext.endsWith('.jpeg') || \r\n             ext.endsWith('.png') || ext.endsWith('.gif') || \r\n             ext.endsWith('.webp');\r\n    })\r\n    .map(file => {\r\n      const { data: urlData } = supabase.storage\r\n        .from('PHOTO')\r\n        .getPublicUrl(file.name);\r\n      \r\n      return {\r\n        name: file.name,\r\n        url: urlData.publicUrl,\r\n        created_at: file.created_at\r\n      };\r\n    });\r\n\r\n  return photos;\r\n}\r\n\r\n// 上传图片到 PHOTO bucket\r\nexport async function uploadPhoto(file: File) {\r\n  const fileExt = file.name.split('.').pop();\r\n  const fileName = `${Date.now()}.${fileExt}`;\r\n\r\n  const { data, error } = await supabase.storage\r\n    .from('PHOTO')\r\n    .upload(fileName, file, {\r\n      cacheControl: '3600',\r\n      upsert: false\r\n    });\r\n\r\n  if (error) {\r\n    throw error;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// 删除图片\r\nexport async function deletePhoto(fileName: string) {\r\n  const { error } = await supabase.storage\r\n    .from('PHOTO')\r\n    .remove([fileName]);\r\n\r\n  if (error) {\r\n    throw error;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// 通用函数：获取指定 bucket 的所有图片\r\nexport async function getImagesFromBucket(bucketName: string) {\r\n  const { data, error } = await supabase.storage\r\n    .from(bucketName)\r\n    .list('', {\r\n      limit: 100,\r\n      offset: 0,\r\n      sortBy: { column: 'created_at', order: 'desc' }\r\n    });\r\n\r\n  if (error) {\r\n    console.error(`Error fetching images from ${bucketName}:`, error);\r\n    return [];\r\n  }\r\n\r\n  const images = data\r\n    .filter(file => {\r\n      const ext = file.name.toLowerCase();\r\n      return ext.endsWith('.jpg') || ext.endsWith('.jpeg') || \r\n             ext.endsWith('.png') || ext.endsWith('.gif') || \r\n             ext.endsWith('.webp');\r\n    })\r\n    .map(file => {\r\n      const { data: urlData } = supabase.storage\r\n        .from(bucketName)\r\n        .getPublicUrl(file.name);\r\n      \r\n      return {\r\n        name: file.name,\r\n        url: urlData.publicUrl,\r\n        created_at: file.created_at\r\n      };\r\n    });\r\n\r\n  return images;\r\n}\r\n\r\n// 通用函数：上传图片到指定 bucket\r\nexport async function uploadImageToBucket(bucketName: string, file: File) {\r\n  const fileExt = file.name.split('.').pop();\r\n  const fileName = `${Date.now()}.${fileExt}`;\r\n\r\n  const { data, error } = await supabase.storage\r\n    .from(bucketName)\r\n    .upload(fileName, file, {\r\n      cacheControl: '3600',\r\n      upsert: false\r\n    });\r\n\r\n  if (error) {\r\n    throw error;\r\n  }\r\n\r\n  // 返回公开 URL\r\n  const { data: urlData } = supabase.storage\r\n    .from(bucketName)\r\n    .getPublicUrl(fileName);\r\n\r\n  return {\r\n    ...data,\r\n    publicUrl: urlData.publicUrl\r\n  };\r\n}\r\n\r\n// 通用函数：从指定 bucket 删除图片\r\nexport async function deleteImageFromBucket(bucketName: string, fileName: string) {\r\n  const { error } = await supabase.storage\r\n    .from(bucketName)\r\n    .remove([fileName]);\r\n\r\n  if (error) {\r\n    throw error;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yira/Documents/code/gemini3-yira-s-website/app/api/hero/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { supabase } from \"@/src/lib/supabase\";\r\n\r\n// 获取首页内容\r\nexport async function GET() {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from(\"hero_content\")\r\n      .select(\"*\")\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Supabase error:\", error);\r\n      // 如果没有数据，返回默认值\r\n      return NextResponse.json({\r\n        main_title: \"小黑的奇幻岛屿\",\r\n        main_subtitle: \"在岩壁上寻找自由，在代码中构建万物\",\r\n        left_card_title: \"山海之息\",\r\n        left_card_description: \"在崎岖的岩壁上寻找自由的支点，在深邃的海底听见心跳的回响。\",\r\n        right_card_title: \"灯火之境\",\r\n        right_card_description: \"一盏复古台灯，一行跳动的代码，在寂静的深夜构建属于未来的碎片。\",\r\n        bottom_text: \"连接有趣的人，一起 Vibe Coding，一起坠入山海。\",\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(data);\r\n  } catch (error) {\r\n    console.error(\"Get hero content error:\", error);\r\n    return NextResponse.json({ error: \"获取失败\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// 更新首页内容\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      main_title,\r\n      main_subtitle,\r\n      left_card_title,\r\n      left_card_description,\r\n      right_card_title,\r\n      right_card_description,\r\n      bottom_text,\r\n    } = body;\r\n\r\n    // 先检查是否有记录\r\n    const { data: existing } = await supabase\r\n      .from(\"hero_content\")\r\n      .select(\"id\")\r\n      .single();\r\n\r\n    let result;\r\n    if (existing) {\r\n      // 更新现有记录\r\n      const { data, error } = await supabase\r\n        .from(\"hero_content\")\r\n        .update({\r\n          main_title,\r\n          main_subtitle,\r\n          left_card_title,\r\n          left_card_description,\r\n          right_card_title,\r\n          right_card_description,\r\n          bottom_text,\r\n        })\r\n        .eq(\"id\", existing.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      result = data;\r\n    } else {\r\n      // 插入新记录\r\n      const { data, error } = await supabase\r\n        .from(\"hero_content\")\r\n        .insert([\r\n          {\r\n            main_title,\r\n            main_subtitle,\r\n            left_card_title,\r\n            left_card_description,\r\n            right_card_title,\r\n            right_card_description,\r\n            bottom_text,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      result = data;\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: result });\r\n  } catch (error) {\r\n    console.error(\"Update hero content error:\", error);\r\n    return NextResponse.json({ error: \"更新失败\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,mBAAmB;YACjC,eAAe;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,YAAY;gBACZ,eAAe;gBACf,iBAAiB;gBACjB,uBAAuB;gBACvB,kBAAkB;gBAClB,wBAAwB;gBACxB,aAAa;YACf;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC5D;AACF;AAGO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,UAAU,EACV,aAAa,EACb,eAAe,EACf,qBAAqB,EACrB,gBAAgB,EAChB,sBAAsB,EACtB,WAAW,EACZ,GAAG;QAEJ,WAAW;QACX,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,oIAAQ,CACtC,IAAI,CAAC,gBACL,MAAM,CAAC,MACP,MAAM;QAET,IAAI;QACJ,IAAI,UAAU;YACZ,SAAS;YACT,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,gBACL,MAAM,CAAC;gBACN;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF,GACC,EAAE,CAAC,MAAM,SAAS,EAAE,EACpB,MAAM,GACN,MAAM;YAET,IAAI,OAAO,MAAM;YACjB,SAAS;QACX,OAAO;YACL,QAAQ;YACR,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CACnC,IAAI,CAAC,gBACL,MAAM,CAAC;gBACN;oBACE;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;gBACF;aACD,EACA,MAAM,GACN,MAAM;YAET,IAAI,OAAO,MAAM;YACjB,SAAS;QACX;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAO;IACzD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC5D;AACF"}}]
}